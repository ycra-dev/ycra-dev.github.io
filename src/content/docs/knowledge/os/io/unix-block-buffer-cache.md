---
title: "UNIX 블록 버퍼 캐시 (Block Buffer Cache)"
description: "디스크 블록을 메인 메모리에 캐싱하여 디스크 I/O 횟수를 줄이는 커널 메커니즘"
tags: ["OS", "IO", "Cache", "Buffer"]
created: 2026-01-23
updated: 2026-01-27
draft: false
slug: knowledge/os/unix-block-buffer-cache
sidebar:
  order: 11
---

## 핵심 개념

블록 버퍼 캐시(Block Buffer Cache)는 디스크 블록을 메인 메모리에 캐싱하여 디스크 I/O 횟수를 줄이는 커널 메커니즘입니다. 디스크 접근은 메모리보다 수천~수만 배 느리므로, 최근 접근한 블록을 메모리에 유지하면 재접근 시 빠르게 서비스할 수 있습니다 (시간적 지역성 활용).

## 동작 원리

### 버퍼 헤더 구조

각 버퍼 헤더는 장치 번호, 블록 번호, 메모리 포인터, 상태 플래그를 가집니다.

### 세 가지 리스트

- **LRU 리스트**: 최근 사용된 버퍼 (LRU 순서)
- **AGE 리스트**: 최근 사용 안 된 버퍼 또는 유효하지 않은 내용
- **EMPTY 리스트**: 물리 메모리가 연결되지 않은 헤더

### 해시 테이블

장치+블록 번호로 빠른 검색을 수행합니다.

### 동작 흐름

- **Read**: 캐시 히트 시 즉시 반환, 미스 시 디스크에서 로드
- **Write**: 캐시에 쓰고 dirty 표시, 나중에 디스크로 flush (write-back)
- **`sync()`**: 30초마다 dirty 버퍼를 디스크에 기록

```
┌─────────────────────────────────────────────┐
│           해시 테이블 (검색용)               │
├─────┬─────┬─────┬─────┬─────┬─────┬────────┤
│  0  │  1  │  2  │ ... │ n-1 │     │        │
└──┬──┴──┬──┴──┬──┴─────┴──┬──┴─────┴────────┘
   │     │     │           │
   ▼     ▼     ▼           ▼
[buf]─[buf]─[buf]       [buf]─[buf]

┌─────────────────────────────────────────────┐
│ LRU 리스트: [MRU] ←→ [버퍼] ←→ ... ←→ [LRU] │
│ AGE 리스트: [버퍼] ←→ [버퍼] ←→ ...          │
│ EMPTY 리스트: [헤더] ←→ [헤더] ←→ ...       │
└─────────────────────────────────────────────┘
```

## 예시

블록 버퍼 캐시는 "책상 위 자료"와 같습니다. 자주 보는 문서는 책상(메모리)에 두고, 덜 보는 건 서랍(디스크)에 보관합니다.

```
read(fd, buf, 1024)
    │
    ▼
해시 테이블 검색 ──hit──> 버퍼에서 복사 (빠름)
    │
   miss
    ▼
AGE/LRU에서 버퍼 할당
    │
    ▼
디스크에서 로드 (느림)
    │
    ▼
버퍼에서 복사
```

- 디스크 I/O 대폭 감소, 쓰기 지연(write-back)으로 성능 향상
- 디스크 드라이버가 요청 정렬 가능 → seek 최적화
- 단점: 시스템 크래시 시 dirty 버퍼 손실 위험, 동기 쓰기 필요 시 성능 저하

## 관련 개념

- [캐시 (Cache)](/knowledge/os/cache/)
- [UNIX 아이노드 (Inode)](/knowledge/os/unix-inode/)
- [BSD 실린더 그룹 (Cylinder Group)](/knowledge/os/bsd-cylinder-group/)
- [버퍼링 (Buffering)](/knowledge/os/buffering/)
