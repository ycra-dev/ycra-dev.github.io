---
title: "컨텍스트 스위치 (Context Switch)"
description: "CPU가 현재 프로세스의 상태를 저장하고 다른 프로세스의 상태를 복원하여 실행을 전환하는 과정"
tags: ["OS", "Process", "Scheduling"]
created: 2026-01-27
updated: 2026-01-27
draft: true
slug: knowledge/os/context-switch
sidebar:
  order: 6
---

## 핵심 개념

컨텍스트 스위치는 **CPU가 현재 실행 중인 프로세스를 멈추고, 다른 프로세스로 전환하는 과정**이다. 이때 "현재 프로세스의 상태를 저장"하고 "다음 프로세스의 상태를 복원"한다.

비유하자면, 여러 권의 책을 번갈아 읽을 때 **책갈피를 끼워두고(저장)**, 다른 책의 **책갈피가 있는 페이지를 펴는(복원)** 것과 같다.

핵심은 컨텍스트 스위치 동안 CPU는 **유용한 작업을 하지 못한다**는 점이다. 순수한 **오버헤드(overhead)**이다.

## 동작 원리

### 컨텍스트 스위치 과정

```
프로세스 P0           운영체제 (커널)           프로세스 P1
───────────          ──────────────          ───────────
  실행 중
     │
     │  인터럽트 / 시스템 콜
     ▼
                   ┌──────────────────┐
                   │ P0 상태를 PCB₀에  │
                   │     저장          │
                   ├──────────────────┤
                   │                  │
                   │ P1 상태를 PCB₁에서│
                   │     복원          │
                   └──────────────────┘
                                                실행 중
                                                   │
                                                   │  인터럽트 / 시스템 콜
                                                   ▼
                   ┌──────────────────┐
                   │ P1 상태를 PCB₁에  │
                   │     저장          │
                   ├──────────────────┤
                   │                  │
                   │ P0 상태를 PCB₀에서│
                   │     복원          │
                   └──────────────────┘
  실행 재개
```

### 3단계 요약

1. **State Save**: 현재 프로세스(P0)의 CPU 레지스터, 프로그램 카운터 등을 PCB에 저장
2. **State Restore**: 다음 프로세스(P1)의 PCB에서 저장된 상태를 CPU에 복원
3. **재개**: P1이 이전에 중단되었던 지점부터 실행 재개

### 발생 시점

| 원인 | 설명 |
|------|------|
| **타임 슬라이스 만료** | 할당된 CPU 시간을 다 씀 (선점 스케줄링) |
| **인터럽트** | I/O 완료, 타이머 등 하드웨어 인터럽트 발생 |
| **시스템 콜** | 프로세스가 I/O 요청 등으로 Waiting 상태 진입 |

### 소요 시간과 비용

- 컨텍스트 스위치는 보통 **수 마이크로초(μs)** 소요된다.
- 이 시간 동안 CPU는 어떤 프로세스의 작업도 수행하지 않는 **순수 오버헤드**이다.
- 컨텍스트 스위치가 너무 잦으면 실제 작업보다 전환에 더 많은 시간을 쓰게 된다.

### 프로세스 vs 스레드 컨텍스트 스위치

| 항목 | 프로세스 컨텍스트 스위치 | 스레드 컨텍스트 스위치 |
|------|--------------------------|------------------------|
| 주소 공간 | 전환 필요 (페이지 테이블 교체) | 불필요 (같은 주소 공간) |
| TLB | 플러시 필요 | 플러시 불필요 |
| 비용 | 무거움 | 가벼움 |

스레드 컨텍스트 스위치가 더 가벼운 이유는 같은 프로세스의 스레드들이 **같은 주소 공간을 공유**하기 때문이다. 메모리 관련 정보를 바꿀 필요가 없다.

## 예시

웹 서버에서의 컨텍스트 스위치:

1. 스레드 A가 클라이언트 요청을 처리 중 (Running)
2. 데이터베이스 쿼리를 보내고 응답을 기다림 → I/O wait → **Waiting** 상태
3. OS가 **스레드 A의 상태를 저장** (컨텍스트 스위치 발생)
4. 스레드 B가 CPU를 받아 다른 클라이언트 요청 처리 (Running)
5. DB 응답 도착 → 스레드 A가 **Ready** 상태로 전환
6. 스케줄러가 스레드 A를 선택하면 **상태를 복원**하고 재개

이렇게 컨텍스트 스위치 덕분에 하나의 CPU로도 여러 작업을 "동시에" 처리하는 것처럼 보이게 할 수 있다.

## 관련 개념

- [프로세스 제어 블록 (PCB)](/knowledge/os/pcb/) - 컨텍스트 스위치 시 저장/복원하는 대상
- [프로세스 상태](/knowledge/os/process-state/) - 컨텍스트 스위치로 인한 상태 전이
- [스레드 (Thread)](/knowledge/os/thread/) - 스레드 간 컨텍스트 스위치는 더 가벼움
